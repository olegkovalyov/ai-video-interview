# üîç JAEGER UI - –ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –†–£–ö–û–í–û–î–°–¢–í–û

## üìã –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–ü–û–ò–°–ö):

### 1Ô∏è‚É£ Service:
- **–í—ã–±–µ—Ä–∏:** `api-gateway`
- **–ß—Ç–æ —ç—Ç–æ:** –ù–∞—à NestJS —Å–µ—Ä–≤–∏—Å

### 2Ô∏è‚É£ Operation:  
- **–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
  - `GET /protected` - –æ–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - `POST /auth/refresh` - auto-refresh —Ç–æ–∫–µ–Ω–æ–≤
  - `GET /health` - health checks
  - `GET /metrics` - Prometheus scraping

### 3Ô∏è‚É£ Tags:
- **http.method:** GET, POST
- **http.status_code:** 200, 201, 401
- **error:** true (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—à–∏–±–æ–∫)

### 4Ô∏è‚É£ Lookback:
- **Last hour** - –¥–ª—è –Ω–∞—à–µ–≥–æ —Ç–µ—Å—Ç–∞
- **Last 15 minutes** - –¥–ª—è —Å–≤–µ–∂–∏—Ö traces

---

## üéØ –ß–¢–û –ò–°–ö–ê–¢–¨ –î–õ–Ø AUTO-REFRESH –¢–ï–°–¢–ê:

### üìä –°–ù–ê–ß–ê–õ–ê –ü–û–ü–†–û–ë–£–ô:
1. **Service:** api-gateway
2. **Operation:** –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
3. **Lookback:** Last hour  
4. **–ù–∞–∂–º–∏:** Find Traces

### üîç –í –†–ï–ó–£–õ–¨–¢–ê–¢–ê–• –ò–©–ò:
- **Traces —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é >100ms** (–æ–±—ã—á–Ω—ã–µ ~10-50ms)
- **Traces —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ /auth/refresh**
- **Traces —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ spans** (—Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

---

## üìà –ß–¢–û –û–ó–ù–ê–ß–ê–Æ–¢ –¶–í–ï–¢–ê –ò –†–ê–ó–ú–ï–†–´:

### üü¢ **–ó–µ–ª–µ–Ω—ã–µ spans:** –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (200 OK)
### üî¥ **–ö—Ä–∞—Å–Ω—ã–µ spans:** –û—à–∏–±–∫–∏ (4xx, 5xx)  
### üìè **–î–ª–∏–Ω–∞ span:** –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
### üìä **–í—ã—Å–æ—Ç–∞:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üé¨ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–ú–ï–† TRACE:

### ‚úÖ **–û–ë–´–ß–ù–´–ô REQUEST (–¥–æ auto-refresh):**
```
GET /protected [45ms] üü¢
‚îú‚îÄ‚îÄ HTTP Request [5ms] üü¢
‚îú‚îÄ‚îÄ JWT Verification [10ms] üü¢  
‚îú‚îÄ‚îÄ Database Query [25ms] üü¢
‚îî‚îÄ‚îÄ Response [5ms] üü¢
```

### üîÑ **AUTO-REFRESH REQUEST (–Ω–∞—à —Ç–µ—Å—Ç):**
```
GET /protected [250ms] üü¢
‚îú‚îÄ‚îÄ HTTP Request [5ms] üü¢
‚îú‚îÄ‚îÄ JWT Verification [10ms] üî¥ (failed - token expired)
‚îú‚îÄ‚îÄ Token Refresh [200ms] üü¢
‚îÇ   ‚îú‚îÄ‚îÄ Keycloak Request [150ms] üü¢
‚îÇ   ‚îú‚îÄ‚îÄ Cookie Update [10ms] üü¢
‚îÇ   ‚îî‚îÄ‚îÄ New JWT Verification [15ms] üü¢
‚îú‚îÄ‚îÄ Database Query [25ms] üü¢  
‚îî‚îÄ‚îÄ Response [5ms] üü¢
```

**–í–∏–¥–∏—à—å —Ä–∞–∑–Ω–∏—Ü—É?** Auto-refresh trace –Ω–∞–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ –∏ –¥–æ–ª—å—à–µ!

---

## üéØ –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó SPAN:

### üñ±Ô∏è –ö–õ–ò–ö–ù–ò –ù–ê TRACE:
–£–≤–∏–¥–∏—à—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

#### üìä **Process Tags:**
- `service.name: api-gateway`
- `service.version: 1.0.0`  

#### üè∑Ô∏è **Span Tags:**
- `http.method: GET`
- `http.url: /protected`
- `http.status_code: 200`
- `user.id: 12345` (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ)

#### üìã **Logs:**
- Timestamp + —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è  

---

## üö® –ü–û–ò–°–ö –ü–†–û–ë–õ–ï–ú:

### üîç **–ú–ï–î–õ–ï–ù–ù–´–ï –ó–ê–ü–†–û–°–´:**
1. **Min Duration:** >500ms
2. **Find Traces**
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π:** –∫–∞–∫–æ–π span —Å–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π?

### üî¥ **–û–®–ò–ë–ö–ò:**
1. **Tags:** `error=true`
2. **Find Traces**  
3. **–°–º–æ—Ç—Ä–∏:** –∫—Ä–∞—Å–Ω—ã–µ spans –∏ error messages

### üîÑ **AUTO-REFRESH –ê–ö–¢–ò–í–ù–û–°–¢–¨:**
1. **Operation:** –Ω–µ –≤—ã–±–∏—Ä–∞–π (–≤—Å–µ)
2. **Tags:** –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º
3. **Min Duration:** >100ms
4. **–ò—â–∏ traces** —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ refresh –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üí° –ö–û–†–†–ï–õ–Ø–¶–ò–Ø –° –î–†–£–ì–ò–ú–ò –°–ò–°–¢–ï–ú–ê–ú–ò:

### üìä **Prometheus + Jaeger:**
1. **Prometheus:** –ø–æ–∫–∞–∑–∞–ª spike –≤ refresh rate
2. **Jaeger:** –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π trace —ç—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º:** –ø–æ—á–µ–º—É refresh –∑–∞–Ω—è–ª –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### üìã **Loki + Jaeger:**  
1. **Jaeger:** –±–µ—Ä–µ–º trace ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: abc123def456)
2. **Loki:** `{job="nestjs-apps"} | json | traceId="abc123def456"`  
3. **–ü–æ–ª—É—á–∞–µ–º:** –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è —ç—Ç–æ–≥–æ trace

---

## üéØ READY FOR DEMO:

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–¥–µ–ª–∞–µ—à—å auto-refresh —Ç–µ—Å—Ç:

1. **–û–±–Ω–æ–≤–∏ Jaeger UI**
2. **–ù–∞–π–¥–∏ trace —Å max duration**  
3. **–ö–ª–∏–∫–Ω–∏ –Ω–∞ –Ω–µ–≥–æ**
4. **–£–≤–∏–¥–∏—à—å –≤–µ—Å—å journey** auto-refresh –ø—Ä–æ—Ü–µ—Å—Å–∞!

**–≠—Ç–æ –∫–∞–∫ "—Ä–µ–Ω—Ç–≥–µ–Ω" —Ç–≤–æ–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞! ü©ª**
